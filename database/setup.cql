DROP KEYSPACE IF EXISTS Hermes; 

CREATE KEYSPACE Hermes WITH replication = {
    'class': 'SimpleStrategy', 
    'replication_factor': '1'
} AND durable_writes = true;

CREATE TABLE Hermes.Channels (
    UUID TIMEUUID PRIMARY KEY,
    Name TEXT,
    Members SET<TEXT>,
    Admins SET<TEXT>,
    Icon BLOB,
);

CREATE TABLE Hermes.Users (
    User_low TEXT PRIMARY KEY,
    Username TEXT,
    PasswordHash TEXT,
    Channels SET<TIMEUUID>,
);

CREATE TABLE Hermes.Messages (
    UUID TIMEUUID,
    channel TIMEUUID,
    message TEXT,
    username TEXT,
    PRIMARY KEY(channel, UUID)
);

CREATE TABLE Hermes.Sessions (
    UUID TIMEUUID PRIMARY KEY,
    Username TEXT,
    LastActive TIMESTAMP
);

CREATE TABLE Hermes.Settings (
    Username TEXT PRIMARY KEY,
    Notifications TINYINT,
    Theme TEXT,
    Color TEXT,
    Image BLOB
);

CREATE TABLE Hermes.Tokens (
    UUID UUID PRIMARY KEY
);

INSERT INTO Hermes.Tokens (UUID) values(uuid());

INSERT INTO Hermes.Users (User_low, Username, PasswordHash, Channels) values('admin', 'Admin', 'aaa', {13814000-1dd2-11b2-8080-808080808080});

INSERT INTO Hermes.Channels (UUID, Name, Members, Admins, Icon) values(13814000-1dd2-11b2-8080-808080808080, 'GLOBAL', {'admin'}, {'admin'}, textAsBlob('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'));

CREATE INDEX ON Hermes.Channels (members);
CREATE INDEX ON Hermes.Channels (admins);
